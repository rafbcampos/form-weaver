set -e

# Run gitleaks for secret detection (if installed)
if command -v gitleaks > /dev/null 2>&1; then
  gitleaks protect --staged --verbose
else
  echo "Warning: gitleaks not installed. Skipping secret detection."
  echo "Install: https://github.com/gitleaks/gitleaks#installing"
fi

# Run lint-staged
npx lint-staged

# TypeScript typecheck
cd client && npx tsc --noEmit
cd ..

# Python checks
cd server
.venv/bin/ruff check src/ tests/
.venv/bin/mypy src/
.venv/bin/python -m pytest tests/ -q
cd ..
